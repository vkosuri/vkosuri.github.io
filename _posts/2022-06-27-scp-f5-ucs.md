---
layout: post
title:  "SCP F5 UCS to a remote host"
author: vkosuri
categories: [ security ]
image: https://cdn.pixabay.com/photo/2015/08/21/00/21/library-898333_1280.jpg
tags: [featured]
toc: true
---
A user configuration set (UCS) is a backup file that contains BIG-IP configuration data that can be used to fully restore a BIG-IP system in the event of a failure or Return Materials Authorization (RMA) replacement. More information about UCS found here https://support.f5.com/csp/article/K4423

The below script uses expect to input the password

``` tcl
#!/usr/bin/expect -f

# set scp location, user and password
set remote_host "10.1.1.1"
set remote_user "tester"
set remote_path "/backup/F5/"
set password "tester"

# set filename to generate host
set fileName "$env(HOSTNAME)_[timestamp -format %Y%m%d]"

# set expect timeout -1 to wait infinte time
set timeout -1

# spawn bash to run ucs command and scp
spawn bash -c "tmsh save sys ucs $fileName && scp /var/local/ucs/$fileName $remote_user@$remote_host:$remote_path"

expect {
  -re ".*es.*o.*" {
    exp_send "yes\r"
    exp_continue
  }
  -re ".*sword.*" {
    exp_send "$password\r"
  }
}
interact
```
More about expect http://tcl.tk/man/expect5.31/expect.1.html
You could find code snippet gist here https://gist.github.com/vkosuri/05b864ca0145df32bd8b784fb2d97659
